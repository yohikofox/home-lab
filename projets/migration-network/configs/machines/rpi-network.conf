# Configuration réseau Raspberry Pi 4 - Post Migration
# Interface WiFi - Migration Freebox → Netgear

# ====================================================
# DHCPCD CONFIGURATION (Raspberry Pi OS)
# ====================================================
# Fichier: /etc/dhcpcd.conf

interface wlan0
static ip_address=10.0.0.100/24
static routers=10.0.0.1
static domain_name_servers=10.0.0.101 1.1.1.1
static domain_search=homelab.local

# ====================================================
# WPA_SUPPLICANT CONFIGURATION
# ====================================================
# Fichier: /etc/wpa_supplicant/wpa_supplicant.conf

ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=FR

# Nouveau réseau Netgear
network={
    ssid="[SSID_NETGEAR_À_DÉFINIR]"
    psk="[WIFI_PASSWORD_À_DÉFINIR]"
    key_mgmt=WPA-PSK
    priority=1
}

# Ancien réseau Freebox (à supprimer après migration)
# network={
#     ssid="[FREEBOX_SSID]" 
#     psk="[FREEBOX_PASSWORD]"
#     key_mgmt=WPA-PSK
#     priority=0
# }

# ====================================================
# SYSTEMD-NETWORKD CONFIGURATION (alternative)
# ====================================================
# Fichier: /etc/systemd/network/wlan0.network
# [Match]
# Name=wlan0
# 
# [Network]
# Address=10.0.0.100/24
# Gateway=10.0.0.1
# DNS=10.0.0.101
# DNS=1.1.1.1
# Domains=homelab.local

# ====================================================
# INFORMATIONS MIGRATION
# ====================================================
# Réseau Avant: WiFi Freebox Ultra (192.168.0.x probablement)
# Réseau Après: WiFi Netgear R7100LG (10.0.0.100)
# Routeur Avant: Freebox (192.168.0.1)
# Routeur Après: Netgear (10.0.0.1)
# DNS: 10.0.0.101 (PiHole sur PC Lenovo)

# ====================================================
# SERVICES HOME ASSISTANT IMPACTÉS
# ====================================================
# Services potentiellement à vérifier:
# - Home Assistant Core (port 8123)
# - Zigbee2MQTT (port 8080)
# - Frigate (port 5000)
# - Mosquitto MQTT (port 1883)
# - Intégrations avec IP hardcodées

# ====================================================
# COMMANDES DE MIGRATION
# ====================================================
# 1. Sauvegarder config actuelle:
#    sudo cp /etc/wpa_supplicant/wpa_supplicant.conf /etc/wpa_supplicant/wpa_supplicant.conf.backup
#    sudo cp /etc/dhcpcd.conf /etc/dhcpcd.conf.backup

# 2. Appliquer nouvelle config:
#    sudo systemctl restart dhcpcd
#    sudo wpa_cli -i wlan0 reconfigure

# 3. Vérifier connexion:
#    ip addr show wlan0
#    ping 10.0.0.1
#    ping 10.0.0.101

# ====================================================
# ROLLBACK PROCEDURE
# ====================================================
# En cas de problème, revenir à l'ancien réseau:
# sudo cp /etc/wpa_supplicant/wpa_supplicant.conf.backup /etc/wpa_supplicant/wpa_supplicant.conf
# sudo cp /etc/dhcpcd.conf.backup /etc/dhcpcd.conf
# sudo systemctl restart dhcpcd

# ====================================================
# VÉRIFICATIONS POST-MIGRATION
# ====================================================
# ping 10.0.0.1                    # Routeur Netgear
# ping 10.0.0.101                  # PC Lenovo
# ping 8.8.8.8                     # Internet
# nslookup homeassistant.local     # DNS local
# curl -I http://localhost:8123    # Home Assistant local